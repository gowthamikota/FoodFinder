<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Restaurants</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <header class="bg-white shadow-md">
    <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-gray-800">All Restaurants</h1>
      <div class="space-x-4">
        <a href="/" class="text-gray-600 hover:text-gray-900">Home</a>
        <a href="/nearby-search" class="text-gray-600 hover:text-gray-900">Nearby Restaurants</a>
        <a href="/image-search" class="text-gray-600 hover:text-gray-900">Image Search</a>
        <a href="/restaurant-list" class="text-gray-600 hover:text-gray-900">All Restaurants</a>
      </div>
    </nav>
  </header>

  <main class="container mx-auto px-6 py-8">
    <section class="bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-2xl font-bold mb-4">Restaurant Directory</h2>

      <div class="mb-4 flex justify-between items-center">
        <div class="flex space-x-2">
          <button id="prev-page" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
            Previous
          </button>
          <button id="next-page" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
            Next
          </button>
        </div>
        <div id="page-info" class="text-gray-600">
          Page 1 of 1
        </div>
      </div>

      <!-- Filters Section -->
      <section class="mb-8">
        <h3 class="text-xl font-semibold mb-4">Filter Restaurants</h3>
        <div class="grid md:grid-cols-2 gap-6">
          <!-- Filter by Country -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h4 class="text-lg font-semibold mb-4">By Country</h4>
            <select id="country" class="w-full px-4 py-2 border rounded mb-4">
              <option value="">All country</option>
              <option value="1">India</option>
              <option value="14">Australia</option>
              <option value="30">Brazil</option>
              <option value="37">Canada</option>
              <option value="94">Indonesia</option>
              <option value="148">New Zealand</option>
              <option value="162">Philippines</option>
              <option value="166">Qatar</option>
              <option value="184">Singapore</option>
              <option value="189">South Africa</option>
              <option value="191">Sri Lanka</option>
              <option value="208">Turkey</option>
              <option value="214">UAE</option>
              <option value="215">United Kingdom</option>
              <option value="216">United States</option>
            </select>
          </div>

          <!-- Filter by Average Cost for Two -->
          <div class="bg-white p-6 rounded-lg shadow-md">
            <h4 class="text-lg font-semibold mb-4">By Average Cost for Two</h4>
            <input type="number" id="avg_cost" placeholder="Enter Average Cost" class="w-full px-4 py-2 border rounded mb-4">
            <button id="filter-cost-btn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
              Filter by Cost
            </button>
          </div>
        </div>
      </section>

      <!-- Search by Restaurant Name -->
      <section class="mb-8">
        <h3 class="text-xl font-semibold mb-4">Search by Restaurant Name</h3>
        <input type="text" id="search-query" placeholder="Enter restaurant name" class="w-full px-4 py-2 border rounded mb-4">
        <button id="search-btn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
          Search
        </button>
      </section>

      <!-- Restaurants List -->
      <div id="restaurants-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Restaurants will be dynamically populated here -->
      </div>
    </section>
  </main>

  <script>
    let currentPage = 1;
    let totalPages = 1;
    const limit = 9;

    const restaurantsContainer = document.getElementById('restaurants-container');
    const pageInfo = document.getElementById('page-info');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    
    const countrySelect = document.getElementById('country');
    const avgCostInput = document.getElementById('avg_cost');
    const searchQueryInput = document.getElementById('search-query');
    const filterCostBtn = document.getElementById('filter-cost-btn');
    const searchBtn = document.getElementById('search-btn');

    filterCostBtn.addEventListener('click', filterRestaurants);
    searchBtn.addEventListener('click', filterRestaurants);

    async function fetchRestaurants(page, country_code = '', avgCost = '', searchQuery = '') {
        try {
            let apiUrl = `/api/restaurants?page=${page}&limit=${limit}`;
            
            if (country_code) apiUrl += `&country_code=${country_code}`;
            if (avgCost) apiUrl += `&avg_cost=${avgCost}`;
            if (searchQuery) apiUrl += `&search=${searchQuery}`;

            console.log("Fetching from URL:", apiUrl);

            const response = await fetch(apiUrl);
            
            if (!response.ok) throw new Error(`API Error: ${response.statusText}`);

            const data = await response.json();

            if (data.restaurants && data.restaurants.length > 0) {
                restaurantsContainer.innerHTML = data.restaurants.map(restaurant => `
                    <div class="bg-white p-4 rounded-lg shadow">
                        <h3 class="font-bold text-lg">${restaurant.name}</h3>
                        <p>Cuisine: ${restaurant.cuisines}</p>
                        <p>Location: ${restaurant.city}, ${restaurant.country}</p>
                        <p>Average Cost for Two: â‚¹${restaurant.average_cost_for_two}</p>
                        <a href="/restaurant/${restaurant.restaurant_id}" class="text-blue-500 hover:underline">
                            View Details
                        </a>
                    </div>
                `).join('');

                totalPages = data.total_pages || 1;
                pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
                prevPageBtn.disabled = currentPage === 1;
                nextPageBtn.disabled = currentPage === totalPages;
            } else {
                restaurantsContainer.innerHTML = `<p class="text-red-500 col-span-full">No restaurants found</p>`;
            }
        } catch (error) {
            console.error("Fetch Error:", error);
            restaurantsContainer.innerHTML = `<p class="text-red-500 col-span-full">Error loading restaurants: ${error.message}</p>`;
        }
    }


    fetchRestaurants(currentPage);


    prevPageBtn.addEventListener('click', () => {
        if (currentPage > 1) {
            currentPage--;
            fetchRestaurants(currentPage, countrySelect.value, avgCostInput.value, searchQueryInput.value);
        }
    });

    nextPageBtn.addEventListener('click', () => {
        if (currentPage < totalPages) {
            currentPage++;
            fetchRestaurants(currentPage, countrySelect.value, avgCostInput.value, searchQueryInput.value);
        }
    });
    function filterRestaurants() {
        currentPage = 1; 
        fetchRestaurants(currentPage, countrySelect.value, avgCostInput.value, searchQueryInput.value);
    }

    countrySelect.addEventListener('change', filterRestaurants);
    filterCostBtn.addEventListener('click', filterRestaurants); 
</script>

</body>
</html>
